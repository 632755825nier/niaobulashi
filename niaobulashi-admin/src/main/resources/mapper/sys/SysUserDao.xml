<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.niaobulashi.modules.sys.dao.SysUserDao">

    <!--查询用户的所有权限-->
    <select id="queryAllPerms" resultType="string">
        SELECT
            m.perms #授权(多个用逗号分隔，如：user:list,user:create)
        FROM
            sys_user_role ur
                LEFT JOIN sys_role_menu rm ON rm.role_id = ur.role_id
                AND rm.delete_flag = #{deleteFlag}
                LEFT JOIN sys_menu m ON m.menu_id = rm.menu_id
                AND m.delete_flag = #{deleteFlag}
        WHERE
            1 = 1
          AND ur.delete_flag = #{deleteFlag}
          AND ur.user_id = #{userId}
    </select>

    <!--查询用户的所有菜单ID-->
    <select id="queryAllMenuId" resultType="long">
        SELECT DISTINCT
            rm.menu_id #菜单ID
        FROM
            sys_user_role ur
                LEFT JOIN sys_role_menu rm ON rm.role_id = ur.role_id
                AND rm.delete_flag = #{deleteFlag}
        WHERE
            ur.delete_flag = #{deleteFlag}
          AND ur.user_id = #{userId};
    </select>
</mapper>